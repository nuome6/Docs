import{isDef as D,isPlainObject as N,keys as w,decodeData as C,wait as R,LoadingIcon as M}from"@vuepress/helper/client";import{useToggle as P,useEventListener as T}from"@vueuse/core";import{defineComponent as B,shallowRef as _,ref as E,computed as h,onMounted as k,h as l}from"vue";import{J as V,C as H}from"../icons-DBCMtobF.js";import"balloon-css/balloon.css";import"../styles/code-demo.scss";const L=CODE_DEMO_OPTIONS,$={html:{types:["html","slim","haml","md","markdown","vue"],map:{html:"none",vue:"none",md:"markdown"}},js:{types:["js","javascript","coffee","coffeescript","ts","typescript","ls","livescript"],map:{js:"none",javascript:"none",coffee:"coffeescript",ls:"livescript",ts:"typescript"}},css:{types:["css","less","sass","scss","stylus","styl"],map:{css:"none",styl:"stylus"}}},I=(e,s,t)=>{const n=document.createElement(e);return N(s)&&w(s).forEach(o=>{if(o.indexOf("data"))n[o]=s[o];else{const r=o.replace("data","");n.dataset[r]=s[o]}}),n},S=e=>({...L,...e,jsLib:Array.from(new Set([L.jsLib,e.jsLib??[]].flat())),cssLib:Array.from(new Set([L.cssLib,e.cssLib??[]].flat()))}),u=(e,s)=>{if(D(e[s]))return e[s];const t=new Promise(n=>{const o=document.createElement("script");o.src=s,document.querySelector("body")?.appendChild(o),o.onload=()=>{n()}});return e[s]=t,t},J=(e,s)=>{if(s.css&&Array.from(e.childNodes).every(t=>t.nodeName!=="STYLE")){const t=I("style",{innerHTML:s.css});e.appendChild(t)}},q=(e,s,t)=>{const n=t.getScript();if(n&&Array.from(s.childNodes).every(o=>o.nodeName!=="SCRIPT")){const o=document.createElement("script");o.appendChild(document.createTextNode(`{const document=window.document.querySelector('#${e} .vp-code-demo-display').shadowRoot;
${n}}`)),s.appendChild(o)}},F=["html","js","css"],G=e=>{const s=w(e),t={html:[],js:[],css:[],isLegal:!1};return F.forEach(n=>{const o=s.filter(r=>$[n].types.includes(r));if(o.length){const r=o[0];t[n]=[e[r].replace(/^\n|\n$/g,""),$[n].map[r]??r]}}),t.isLegal=(!t.html.length||t.html[1]==="none")&&(!t.js.length||t.js[1]==="none")&&(!t.css.length||t.css[1]==="none"),t},x=e=>e.replace(/<br \/>/g,"<br>").replace(/<((\S+)[^<]*?)\s+\/>/g,"<$1></$2>"),O=e=>`<div id="app">
${x(e)}
</div>`,Y=e=>`${e.replace("export default ","const $reactApp = ").replace(/App\.__style__(\s*)=(\s*)`([\s\S]*)?`/,"")};
ReactDOM.createRoot(document.getElementById("app")).render(React.createElement($reactApp))`,K=e=>e.replace(/export\s+default\s*\{(\n*[\s\S]*)\n*\}\s*;?$/u,"Vue.createApp({$1}).mount('#app')").replace(/export\s+default\s*define(Async)?Component\s*\(\s*\{(\n*[\s\S]*)\n*\}\s*\)\s*;?$/u,"Vue.createApp({$1}).mount('#app')").trim(),A=e=>`(function(exports){var module={};module.exports=exports;${e};return module.exports.__esModule?exports.default:module.exports;})({})`,U=(e,s)=>{const t=S(s),n=e.js[0]??"";return{...t,html:x(e.html[0]??""),js:n,css:e.css[0]??"",isLegal:e.isLegal,getScript:()=>t.useBabel?window.Babel?.transform(n,{presets:["es2015"]})?.code??"":n}},W=/<template>([\s\S]+)<\/template>/u,z=/<script(\s*lang=(['"])(.*?)\2)?>([\s\S]+)<\/script>/u,Q=/<style(\s*lang=(['"])(.*?)\2)?\s*(?:scoped)?>([\s\S]+)<\/style>/u,X=(e,s)=>{const t=S(s),n=e.html[0]??"",o=W.exec(n),r=z.exec(n),c=Q.exec(n),d=o?.[1].replace(/^\n|\n$/g,"")??"",[i="",p=""]=r?[r[4].replace(/^\n|\n$/g,""),r[3]]:[],[a="",v=""]=c?[c[4].replace(/^\n|\n$/g,""),c[3]]:[],f=p===""&&(v===""||v==="css");return{...t,html:O(d),js:K(i),css:a,isLegal:f,jsLib:[t.vue,...t.jsLib],getScript:()=>{const g=s.useBabel?window.Babel?.transform(i,{presets:["es2015"]})?.code??"":i.replace(/export\s+default/u,"return");return`const app=window.document.createElement('div');document.firstElementChild.appendChild(app);const appOptions=${A(g)};appOptions.template=\`${d.replace("`",'\\`"')}\`;window.Vue.createApp(appOptions).mount(app);`}}},Z=(e,s)=>{const t=S(s),n=e.js[0]??"";return{...t,html:O(""),js:Y(n),css:e.css[0]??e.js[0]?.replace(/App\.__style__(?:\s*)=(?:\s*)`([\s\S]*)?`/,"$1").trim()??"",isLegal:e.isLegal,jsLib:[t.react,t.reactDOM,...t.jsLib],jsx:!0,getScript:()=>{const o=window.Babel?.transform(n,{presets:["es2015","react"]})?.code??"";return`window.ReactDOM.createRoot(document.firstElementChild).render(window.React.createElement(${A(o)}))`}}},m={},ee=e=>Promise.all([u(m,e.babel),u(m,e.react),u(m,e.reactDOM)]),te=e=>{const s=[u(m,e.vue)];return e.useBabel&&s.push(u(m,e.babel)),Promise.all(s)},se=e=>e.useBabel?u(m,e.babel):Promise.resolve();var ae=B({name:"CodeDemo",props:{id:{type:String,required:!0},type:{type:String,default:"normal"},title:{type:String,default:""},config:{type:String,default:""},code:{type:String,required:!0}},slots:Object,setup(e,{slots:s}){const[t,n]=P(!1),o=_(),r=_(),c=E("0"),d=E(!1),i=h(()=>JSON.parse(e.config?C(e.config):"{}")),p=h(()=>{const y=JSON.parse(C(e.code));return G(y)}),a=h(()=>e.type==="react"?Z(p.value,i.value):e.type==="vue"?X(p.value,i.value):U(p.value,i.value)),v=h(()=>a.value.isLegal),f=(y=!1)=>{const b=o.value.attachShadow({mode:"open"}),j=document.createElement("div");j.classList.add("code-demo-app"),b.appendChild(j),v.value?(y&&(j.innerHTML=a.value.html),J(b,a.value),q(e.id,b,a.value),c.value="0"):c.value="auto",d.value=!0},g=()=>{switch(e.type){case"react":return ee(a.value).then(()=>{f()});case"vue":return te(a.value).then(()=>{f()});default:return se(a.value).then(()=>{f(!0)})}};return T("beforeprint",()=>{n(!0)}),k(async()=>{await R(MARKDOWN_ENHANCE_DELAY),await g()}),()=>l("div",{class:"vp-container vp-code-demo",id:e.id},[l("div",{class:"vp-container-header"},[a.value.isLegal?l("button",{type:"button",title:"toggle","aria-hidden":!0,class:["vp-code-demo-toggle-button",t.value?"down":"end"],onClick:()=>{c.value=t.value?"0":`${r.value.clientHeight+13.8}px`,n()}}):null,e.title?l("span",{class:"vp-container-title"},decodeURIComponent(e.title)):null,a.value.isLegal&&a.value.jsfiddle!==!1?l("form",{class:"code-demo-jsfiddle",target:"_blank",action:"https://jsfiddle.net/api/post/library/pure/",method:"post"},[l("input",{type:"hidden",name:"html",value:a.value.html}),l("input",{type:"hidden",name:"js",value:a.value.js}),l("input",{type:"hidden",name:"css",value:a.value.css}),l("input",{type:"hidden",name:"wrap",value:"1"}),l("input",{type:"hidden",name:"panel_js",value:"3"}),l("input",{type:"hidden",name:"resources",value:[...a.value.cssLib,...a.value.jsLib].join(",")}),l("button",{type:"submit",class:"jsfiddle-button",innerHTML:V,"aria-label":"JSFiddle","data-balloon-pos":"down"})]):null,!a.value.isLegal||a.value.codepen!==!1?l("form",{class:"code-demo-codepen",target:"_blank",action:"https://codepen.io/pen/define",method:"post"},[l("input",{type:"hidden",name:"data",value:JSON.stringify({html:a.value.html,js:a.value.js,css:a.value.css,js_external:a.value.jsLib.join(";"),css_external:a.value.cssLib.join(";"),layout:a.value.codepenLayout,html_pre_processor:p.value.html[1]??"none",js_pre_processor:p.value.js[1]??(a.value.jsx?"babel":"none"),css_pre_processor:p.value.css[1]??"none",editors:a.value.codepenEditors})}),l("button",{type:"submit",innerHTML:H,class:"codepen-button","aria-label":"Codepen","data-balloon-pos":"down"})]):null]),d.value?null:l(M,{class:"vp-code-demo-loading"}),l("div",{ref:o,class:"vp-code-demo-display",style:{display:v.value&&d.value?"block":"none"}}),l("div",{class:"vp-code-demo-code-wrapper",style:{height:c.value}},l("div",{ref:r,class:"vp-code-demo-codes"},s.default()))])}});export{ae as default};
//# sourceMappingURL=CodeDemo.js.map
