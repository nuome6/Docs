{"version":3,"file":"index.js","sources":["../../src/node/shiki.ts","../../src/node/markdown/highlighter/createMarkdownFilePathGetter.ts","../../src/node/markdown/highlighter/createShikiHighlighter.ts","../../src/node/transformers/vuepressTransformers.ts","../../src/node/transformers/getTransformers.ts","../../src/node/utils.ts","../../src/node/markdown/highlighter/getLanguage.ts","../../src/node/markdown/highlighter/handleMustache.ts","../../src/node/markdown/highlighter/getHighLightFunction.ts","../../src/node/markdown/highlightLinesPlugin.ts","../../src/node/markdown/preWrapperPlugin.ts","../../src/node/prepareClientConfigFile.ts","../../src/node/shikiPlugin.ts"],"sourcesContent":["import { bundledLanguages } from 'shiki'\n\nexport { bundledLanguages } from 'shiki'\n\nexport const bundledLanguageNames = Object.keys(bundledLanguages)\n","import type MarkdownIt from 'markdown-it'\nimport type { MarkdownEnv } from 'vuepress/markdown'\n\nexport type MarkdownFilePathGetter = () => string\n\nexport const createMarkdownFilePathGetter = (\n  md: MarkdownIt,\n): MarkdownFilePathGetter => {\n  const store: { path?: string | null } = {}\n\n  const rawRender = md.render.bind(md)\n\n  // we need to store file path before each render\n  md.render = (src, env: MarkdownEnv = {}) => {\n    store.path = env.filePathRelative\n\n    return rawRender(src, env)\n  }\n\n  return () => store.path || 'dynamic pages'\n}\n","import type { BundledLanguage, BundledTheme, HighlighterGeneric } from 'shiki'\nimport { createHighlighter } from 'shiki'\nimport { bundledLanguageNames } from '../../shiki.js'\nimport type { ShikiHighlightOptions } from '../../types.js'\n\nexport const createShikiHighlighter = async ({\n  langs = bundledLanguageNames,\n  langAlias = {},\n  defaultLang,\n  shikiSetup,\n  ...options\n}: ShikiHighlightOptions = {}): Promise<\n  HighlighterGeneric<BundledLanguage, BundledTheme>\n> => {\n  const shikiHighlighter = await createHighlighter({\n    langs,\n    langAlias,\n    themes:\n      'themes' in options\n        ? Object.values(options.themes)\n        : [options.theme ?? 'nord'],\n  })\n\n  await shikiSetup?.(shikiHighlighter)\n\n  return shikiHighlighter\n}\n","import type { ShikiTransformer } from 'shiki'\n\nconst CODE_ESCAPE_RE = /\\[\\\\!code/g\n\nexport const addClassTransformer: ShikiTransformer = {\n  name: 'vuepress:add-class',\n  pre(node) {\n    this.addClassToHast(node, 'vp-code')\n  },\n}\n\nexport const cleanupTransformer: ShikiTransformer = {\n  name: 'vuepress:cleanup',\n  pre(node) {\n    delete node.properties.tabindex\n  },\n}\n\n/**\n * This `transformer` is primarily for the usage instructions of themes.\n * When developers need to provide an example like `// [!code xxx]`,\n * they can use `// [\\!code xxx]` to avoid being processed by `shiki`.\n * After `shiki` completes the processing,\n * replace `[\\!code` back with `[!code` to display the correct text.\n */\nexport const removeEscapeTransformer: ShikiTransformer = {\n  name: 'vuepress:remove-escape',\n  postprocess(code) {\n    return code.replace(CODE_ESCAPE_RE, '[!code')\n  },\n}\n\nexport const emptyLineTransformer: ShikiTransformer = {\n  name: 'vuepress:empty-line',\n  code(hast) {\n    hast.children.forEach((span) => {\n      if (\n        span.type === 'element' &&\n        span.tagName === 'span' &&\n        Array.isArray(span.properties.class) &&\n        span.properties.class.includes('line') &&\n        span.children.length === 0\n      ) {\n        span.children.push({\n          type: 'element',\n          tagName: 'wbr',\n          properties: {},\n          children: [],\n        })\n      }\n    })\n  },\n}\n","import {\n  transformerMetaWordHighlight,\n  transformerNotationDiff,\n  transformerNotationErrorLevel,\n  transformerNotationFocus,\n  transformerNotationHighlight,\n  transformerNotationWordHighlight,\n  transformerRenderWhitespace,\n} from '@shikijs/transformers'\nimport type { WhitespacePosition } from '@vuepress/highlighter-helper'\nimport { resolveWhitespacePosition } from '@vuepress/highlighter-helper'\nimport type { ShikiTransformer } from 'shiki'\nimport type { ShikiHighlightOptions } from '../types.js'\nimport {\n  addClassTransformer,\n  cleanupTransformer,\n  emptyLineTransformer,\n  removeEscapeTransformer,\n} from './vuepressTransformers.js'\n\nexport const getTransformers = (\n  options: ShikiHighlightOptions,\n): ShikiTransformer[] => {\n  const transformers: ShikiTransformer[] = []\n\n  if (options.notationDiff) {\n    transformers.push(transformerNotationDiff())\n  }\n\n  if (options.notationFocus) {\n    transformers.push(\n      transformerNotationFocus({\n        classActiveLine: 'has-focus',\n        classActivePre: 'has-focused-lines',\n      }),\n    )\n  }\n\n  if (options.notationHighlight) {\n    transformers.push(transformerNotationHighlight())\n  }\n\n  if (options.notationErrorLevel) {\n    transformers.push(transformerNotationErrorLevel())\n  }\n\n  if (options.notationWordHighlight) {\n    transformers.push(transformerNotationWordHighlight())\n    transformers.push(transformerMetaWordHighlight())\n  }\n\n  transformers.push(\n    addClassTransformer,\n    cleanupTransformer,\n    removeEscapeTransformer,\n    emptyLineTransformer,\n  )\n\n  return transformers\n}\n\nexport const whitespaceTransformer = (\n  meta: string,\n  defaultPosition: WhitespacePosition | boolean = false,\n): ShikiTransformer[] => {\n  const position = resolveWhitespacePosition(meta, defaultPosition)\n  // disable current code block\n  if (position === false) return []\n\n  return [transformerRenderWhitespace({ position })]\n}\n","import type { TransformerCompactLineOption } from '@shikijs/transformers'\nimport { Logger } from '@vuepress/helper'\nimport { customAlphabet } from 'nanoid'\n\nconst VUE_RE = /-vue$/\n\nexport const PLUGIN_NAME = '@vuepress/plugin-shiki'\n\nexport const logger = new Logger(PLUGIN_NAME)\n\nexport const nanoid = customAlphabet('abcdefghijklmnopqrstuvwxyz', 10)\n\nexport const resolveLanguage = (info: string): string =>\n  info\n    .match(/^([^ :[{]+)/)?.[1]\n    ?.replace(VUE_RE, '')\n    .toLowerCase() ?? ''\n\nexport const resolveAttr = (info: string, attr: string): string | null => {\n  // try to match specified attr mark\n  const pattern = `\\\\b${attr}\\\\s*=\\\\s*(?<quote>['\"])(?<content>.+?)\\\\k<quote>(\\\\s|$)`\n  const regex = new RegExp(pattern, 'i')\n  const match = info.match(regex)\n\n  // return content if matched, null if not specified\n  return match?.groups?.content ?? null\n}\n\n/**\n * 2 steps:\n *\n * 1. convert attrs into line numbers:\n *    {4,7-13,16,23-27,40} -> [4,7,8,9,10,11,12,13,16,23,24,25,26,27,40]\n * 2. convert line numbers into line options:\n *    [{ line: number, classes: string[] }]\n */\nexport const attrsToLines = (attrs: string): TransformerCompactLineOption[] => {\n  const attrsContent = attrs.replace(/^(?:\\[.*?\\])?.*?([\\d,-]+).*/, '$1').trim()\n\n  const result: number[] = []\n\n  if (!attrsContent) {\n    return []\n  }\n\n  attrsContent\n    .split(',')\n    .map((lineNumberConfig) =>\n      lineNumberConfig.split('-').map((lineNumber) => parseInt(lineNumber, 10)),\n    )\n    .forEach(([start, end]) => {\n      if (start && end) {\n        result.push(\n          ...Array.from({ length: end - start + 1 }, (_, i) => start + i),\n        )\n      } else {\n        result.push(start)\n      }\n    })\n\n  return result.map((line) => ({\n    line,\n    classes: ['highlighted'],\n  }))\n}\n","import { isSpecialLang } from 'shiki'\nimport { colors } from 'vuepress/utils'\nimport type { ShikiHighlightOptions } from '../../types.js'\nimport { logger, resolveLanguage } from '../../utils.js'\nimport type { MarkdownFilePathGetter } from './createMarkdownFilePathGetter.js'\n\nconst WARNED_LANGS = new Set<string>()\n\nexport const getLanguage = (\n  lang: string,\n  loadedLanguages: string[],\n  { defaultLang, logLevel }: ShikiHighlightOptions,\n  markdownFilePathGetter: MarkdownFilePathGetter,\n): string => {\n  let result = resolveLanguage(lang)\n\n  if (result && !loadedLanguages.includes(result) && !isSpecialLang(result)) {\n    // warn for unknown languages only once\n    if (logLevel !== 'silent' && !WARNED_LANGS.has(result)) {\n      logger.warn(\n        `Missing ${colors.cyan(lang)} highlighter, ${defaultLang ? `use ${colors.cyan(defaultLang)} to highlight instead.` : 'skip highlighting'}`,\n      )\n      WARNED_LANGS.add(result)\n    }\n\n    // log file path if unknown language is found\n    if (logLevel === 'debug') {\n      logger.info(\n        `Unknown language ${colors.cyan(result)} found in ${colors.cyan(markdownFilePathGetter())}`,\n      )\n    }\n\n    result = defaultLang || 'plain'\n  }\n\n  return result\n}\n","import { nanoid } from '../../utils.js'\n\nconst MUSTACHE_REG = /\\{\\{[^]*?\\}\\}/g\n\ntype MustacheStore = Map<string, string>\n\n/**\n * Replace mustache with unique markers\n * @param str content\n * @param store mustache store\n * @returns\n */\nconst removeMustache = (str: string, store: MustacheStore): string =>\n  str.replace(MUSTACHE_REG, (match) => {\n    let marker = store.get(match)\n\n    if (!marker) {\n      marker = nanoid()\n      store.set(match, marker)\n    }\n\n    return marker\n  })\n\nconst restoreMustache = (str: string, store: MustacheStore): string => {\n  let result = str\n\n  store.forEach((marker, match) => {\n    result = result.replaceAll(marker, match)\n  })\n\n  return result\n}\n\nexport const handleMustache = (\n  str: string,\n  highlight: (str: string) => string,\n): string => {\n  const store = new Map<string, string>()\n\n  return restoreMustache(highlight(removeMustache(str, store).trimEnd()), store)\n}\n","import { transformerCompactLineOptions } from '@shikijs/transformers'\nimport type { BundledLanguage, BundledTheme, HighlighterGeneric } from 'shiki'\nimport {\n  getTransformers,\n  whitespaceTransformer,\n} from '../../transformers/getTransformers.js'\nimport type { ShikiHighlightOptions } from '../../types.js'\nimport { attrsToLines } from '../../utils.js'\nimport type { MarkdownFilePathGetter } from './createMarkdownFilePathGetter.js'\nimport { getLanguage } from './getLanguage.js'\nimport { handleMustache } from './handleMustache.js'\n\ntype MarkdownItHighlight = (\n  content: string,\n  language: string,\n  attrs: string,\n) => string\n\nexport const getHighLightFunction = (\n  highlighter: HighlighterGeneric<BundledLanguage, BundledTheme>,\n  options: ShikiHighlightOptions,\n  markdownFilePathGetter: MarkdownFilePathGetter,\n): MarkdownItHighlight => {\n  const transformers = getTransformers(options)\n  const loadedLanguages = highlighter.getLoadedLanguages()\n\n  return (content, language, attrs) =>\n    handleMustache(content, (str) =>\n      highlighter.codeToHtml(str, {\n        lang: getLanguage(\n          language,\n          loadedLanguages,\n          options,\n          markdownFilePathGetter,\n        ),\n        meta: {\n          /**\n           * Custom `transformers` passed by users may require `attrs`.\n           * e.g. [transformerNotationWordHighlight](https://shiki.style/packages/transformers#transformernotationwordhighlight)\n           */\n          __raw: attrs,\n        },\n        transformers: [\n          ...transformers,\n          ...((options.highlightLines ?? true)\n            ? [transformerCompactLineOptions(attrsToLines(attrs))]\n            : []),\n          ...whitespaceTransformer(attrs, options.whitespace),\n          ...(options.transformers ?? []),\n        ],\n        ...('themes' in options\n          ? {\n              themes: options.themes,\n              defaultColor: false,\n            }\n          : { theme: options.theme ?? 'nord' }),\n      }),\n    )\n}\n","// Modified from https://github.com/egoist/markdown-it-highlight-lines\n// Now this plugin is only used to normalize line attrs.\n// The else part of line highlights logic is in '../highlight.ts'.\n\nimport type { Markdown } from 'vuepress/markdown'\n\nconst HIGHLIGHT_LINES_REGEXP = /{([\\d,-]+)}/\n\nexport const highlightLinesPlugin = (md: Markdown): void => {\n  const rawFence = md.renderer.rules.fence!\n\n  md.renderer.rules.fence = (...args) => {\n    const [tokens, idx] = args\n    const token = tokens[idx]\n\n    const rawInfo = token.info || ''\n    const result = rawInfo.match(HIGHLIGHT_LINES_REGEXP)\n\n    if (!result) {\n      return rawFence(...args)\n    }\n\n    // ensure the next plugin get the correct lang\n    token.info = rawInfo.replace(HIGHLIGHT_LINES_REGEXP, '').trim()\n\n    const lines = result[1]\n\n    token.info += ` ${lines}`\n    return rawFence(...args)\n  }\n}\n","// markdown-it plugin for generating line numbers.\n// v-pre block logic is in `../highlight.ts`\nimport type { Markdown } from 'vuepress/markdown'\nimport { resolveAttr, resolveLanguage } from '../utils.js'\n\nconst PRE_ATTRS_REGEXP = /<pre([\\s\\S]*?)style=\"([^\"]*)\"([^>]*)>/\n\nexport interface MarkdownItPreWrapperOptions {\n  /**\n   * Wrap the `<pre>` tag with an extra `<div>` or not. Do not disable it unless you\n   * understand what's it for\n   *\n   * - Required for line numbers, title display and code block collapsing\n   */\n  preWrapper?: boolean\n}\n\nexport const preWrapperPlugin = (\n  md: Markdown,\n  { preWrapper = true }: MarkdownItPreWrapperOptions = {},\n): void => {\n  const rawFence = md.renderer.rules.fence!\n\n  md.renderer.rules.fence = (...args) => {\n    let result = rawFence(...args)\n\n    if (!result.startsWith('<pre')) {\n      return result\n    }\n\n    const [tokens, idx, options] = args\n    const token = tokens[idx]\n\n    // get token info\n    const info = token.info ? md.utils.unescapeAll(token.info).trim() : ''\n\n    const lang = resolveLanguage(info)\n    const languageClass = `${options.langPrefix}${lang}`\n\n    if (!preWrapper) {\n      /**\n       * remove `<code>` attributes\n       *\n       * In the source code of `markdown-it fence line 71, line 74`,\n       * `fence` writes `class=\"language-*\"` onto the `code` element,\n       * whereas in past versions, `vuepress` wrote it on the `pre` element.\n       * Therefore, this behavior needs to be reset.\n       *\n       * Even though `shiki` directly returns the contents within `<pre>`\n       * at `line 48` of `markdown-it`, I believe it is still prudent to make this adjustment.\n       *\n       * @see https://github.com/markdown-it/markdown-it/blob/master/lib/renderer.mjs\n       */\n      result = result.replace(/<code[^]*?>/, '<code>')\n      result = `<pre class=\"${languageClass}\"${result.slice('<pre'.length)}`\n      return result\n    }\n\n    const title = resolveAttr(info, 'title') || lang\n    let styles = ''\n\n    // before: maybe `v-pre class=\"shiki *\"`\n    // after: style=\"*\" tab-index=\"*\"\n    result = result.replace(\n      PRE_ATTRS_REGEXP,\n      (_, before: string, style: string, after: string) => {\n        styles = style.trim()\n        // Keep `v-pre class=\"*\"`, remove the rest.\n        return `<pre ${before.trim()}${after.trimEnd()}>`\n      },\n    )\n\n    /**\n     * Add information to dataset for current code block.\n     */\n    return `<div class=\"${languageClass}\" data-highlighter=\"shiki\" data-ext=\"${lang}\" data-title=\"${title}\" style=\"${styles}\">${result}</div>`\n  }\n}\n","import { getModulePath } from '@vuepress/helper'\nimport type { App } from 'vuepress'\nimport type { ShikiPluginOptions } from './options.js'\nimport { PLUGIN_NAME } from './utils.js'\n\nexport const prepareClientConfigFile = (\n  app: App,\n  {\n    lineNumbers = true,\n    highlightLines = true,\n    collapsedLines = 'disable',\n    notationDiff,\n    notationErrorLevel,\n    notationFocus,\n    notationHighlight,\n    notationWordHighlight,\n    whitespace,\n  }: ShikiPluginOptions,\n): Promise<string> => {\n  const imports: string[] = [\n    `import \"${getModulePath('@vuepress/highlighter-helper/styles/base.css', import.meta)}\"`,\n    `import \"${getModulePath(`${PLUGIN_NAME}/styles/shiki.css`, import.meta)}\"`,\n  ]\n\n  const setups: string[] = []\n\n  if (lineNumbers !== 'disable') {\n    imports.push(\n      `import \"${getModulePath('@vuepress/highlighter-helper/styles/line-numbers.css', import.meta)}\"`,\n    )\n  }\n\n  if (highlightLines || notationHighlight) {\n    imports.push(\n      `import \"${getModulePath('@vuepress/highlighter-helper/styles/notation-highlight.css', import.meta)}\"`,\n    )\n  }\n\n  if (notationDiff) {\n    imports.push(\n      `import \"${getModulePath('@vuepress/highlighter-helper/styles/notation-diff.css', import.meta)}\"`,\n    )\n  }\n\n  if (notationErrorLevel) {\n    imports.push(\n      `import \"${getModulePath('@vuepress/highlighter-helper/styles/notation-error-level.css', import.meta)}\"`,\n    )\n  }\n\n  if (notationFocus) {\n    imports.push(\n      `import \"${getModulePath('@vuepress/highlighter-helper/styles/notation-focus.css', import.meta)}\"`,\n    )\n  }\n\n  if (notationHighlight) {\n    imports.push(\n      `import \"${getModulePath('@vuepress/highlighter-helper/styles/notation-highlight.css', import.meta)}\"`,\n    )\n  }\n\n  if (notationWordHighlight) {\n    imports.push(\n      `import \"${getModulePath('@vuepress/highlighter-helper/styles/notation-word-highlight.css', import.meta)}\"`,\n    )\n  }\n\n  if (whitespace) {\n    imports.push(\n      `import \"${getModulePath('@vuepress/highlighter-helper/styles/whitespace.css', import.meta)}\"`,\n    )\n  }\n\n  if (collapsedLines !== 'disable') {\n    imports.push(\n      `import \"${getModulePath('@vuepress/highlighter-helper/styles/collapsed-lines.css', import.meta)}\"`,\n      `import { setupCollapsedLines } from \"${getModulePath('@vuepress/highlighter-helper/client', import.meta)}\"`,\n    )\n    setups.push('setupCollapsedLines()')\n  }\n\n  let code = imports.join('\\n')\n\n  if (setups.length) {\n    code += `\\n\nexport default {\n  setup() {\n    ${setups.join('\\n    ')}\n  }\n}\\n`\n  }\n\n  return app.writeTemp('shiki/config.js', code)\n}\n","import type {\n  MarkdownItCollapsedLinesOptions,\n  MarkdownItLineNumbersOptions,\n} from '@vuepress/highlighter-helper'\nimport {\n  collapsedLines as collapsedLinesPlugin,\n  lineNumbers as lineNumbersPlugin,\n} from '@vuepress/highlighter-helper'\nimport type { Plugin } from 'vuepress/core'\nimport { isPlainObject } from 'vuepress/shared'\nimport { createMarkdownFilePathGetter } from './markdown/highlighter/createMarkdownFilePathGetter.js'\nimport type { MarkdownItPreWrapperOptions } from './markdown/index.js'\nimport {\n  createShikiHighlighter,\n  getHighLightFunction,\n  highlightLinesPlugin,\n  preWrapperPlugin,\n} from './markdown/index.js'\nimport type { ShikiPluginOptions } from './options.js'\nimport { prepareClientConfigFile } from './prepareClientConfigFile.js'\n\nexport const shikiPlugin = (_options: ShikiPluginOptions = {}): Plugin => {\n  return (app) => {\n    // FIXME: Remove in stable version\n    // eslint-disable-next-line @typescript-eslint/no-deprecated\n    const { code } = app.options.markdown\n    const options = {\n      ...(isPlainObject(code) ? code : {}),\n      ..._options,\n    }\n\n    options.logLevel ??= app.env.isDebug ? 'debug' : 'warn'\n    options.preWrapper ??= true\n    options.lineNumbers ??= true\n    options.collapsedLines ??= 'disable'\n\n    return {\n      name: '@vuepress/plugin-shiki',\n\n      extendsMarkdown: async (md) => {\n        const { preWrapper, lineNumbers, collapsedLines } = options\n\n        const markdownFilePathGetter = createMarkdownFilePathGetter(md)\n        const shikiHighlighter = await createShikiHighlighter(options)\n\n        md.options.highlight = getHighLightFunction(\n          shikiHighlighter,\n          options,\n          markdownFilePathGetter,\n        )\n\n        md.use(highlightLinesPlugin)\n        md.use<MarkdownItPreWrapperOptions>(preWrapperPlugin, { preWrapper })\n        if (preWrapper) {\n          md.use<MarkdownItLineNumbersOptions>(lineNumbersPlugin, {\n            lineNumbers,\n          })\n          md.use<MarkdownItCollapsedLinesOptions>(collapsedLinesPlugin, {\n            collapsedLines,\n          })\n        }\n      },\n\n      clientConfigFile: () => prepareClientConfigFile(app, options),\n    }\n  }\n}\n"],"names":["bundledLanguageNames","bundledLanguages","createMarkdownFilePathGetter","md","store","rawRender","src","env","createShikiHighlighter","langs","langAlias","defaultLang","shikiSetup","options","shikiHighlighter","createHighlighter","CODE_ESCAPE_RE","addClassTransformer","node","cleanupTransformer","removeEscapeTransformer","code","emptyLineTransformer","hast","span","getTransformers","transformers","transformerNotationDiff","transformerNotationFocus","transformerNotationHighlight","transformerNotationErrorLevel","transformerNotationWordHighlight","transformerMetaWordHighlight","whitespaceTransformer","meta","defaultPosition","position","resolveWhitespacePosition","transformerRenderWhitespace","VUE_RE","PLUGIN_NAME","logger","Logger","nanoid","customAlphabet","resolveLanguage","info","resolveAttr","attr","pattern","regex","attrsToLines","attrs","attrsContent","result","lineNumberConfig","lineNumber","start","end","_","i","line","WARNED_LANGS","getLanguage","lang","loadedLanguages","logLevel","markdownFilePathGetter","isSpecialLang","colors","MUSTACHE_REG","removeMustache","str","match","marker","restoreMustache","handleMustache","highlight","getHighLightFunction","highlighter","content","language","transformerCompactLineOptions","HIGHLIGHT_LINES_REGEXP","highlightLinesPlugin","rawFence","args","tokens","idx","token","rawInfo","lines","PRE_ATTRS_REGEXP","preWrapperPlugin","preWrapper","languageClass","title","styles","before","style","after","prepareClientConfigFile","app","lineNumbers","highlightLines","collapsedLines","notationDiff","notationErrorLevel","notationFocus","notationHighlight","notationWordHighlight","whitespace","imports","getModulePath","setups","shikiPlugin","_options","isPlainObject","lineNumbersPlugin","collapsedLinesPlugin"],"mappings":"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"}