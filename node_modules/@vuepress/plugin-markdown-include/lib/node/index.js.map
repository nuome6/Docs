{"version":3,"file":"index.js","sources":["../../src/node/markdownIncludePlugin.ts"],"sourcesContent":["import type { IncludeEnv } from '@mdit/plugin-include'\nimport { include } from '@mdit/plugin-include'\nimport type { Plugin } from 'vuepress/core'\nimport type { MarkdownEnv } from 'vuepress/markdown'\nimport { path } from 'vuepress/utils'\nimport type { MarkdownIncludePluginOptions } from './options.js'\n\nexport const markdownIncludePlugin =\n  (options: MarkdownIncludePluginOptions): Plugin =>\n  (app) => {\n    const source = app.dir.source()\n\n    return {\n      name: '@vuepress/plugin-markdown-include',\n\n      extendsMarkdown: (md) => {\n        md.use(include, {\n          currentPath: (env: MarkdownEnv) => env.filePath,\n          ...options,\n        })\n      },\n      extendsPage: (page): void => {\n        const { markdownEnv, frontmatter, filePathRelative } = page\n        const { includedFiles = [] } = markdownEnv as IncludeEnv\n\n        // mark included files as page deps\n        page.deps.push(...includedFiles)\n\n        // add included files as git deps\n        ;((frontmatter.gitInclude as string[] | undefined) ??= []).push(\n          ...includedFiles.map((file) =>\n            path.relative(\n              path.resolve(source, filePathRelative, '..'),\n              path.resolve(source, filePathRelative, file),\n            ),\n          ),\n        )\n      },\n    }\n  }\n"],"names":["markdownIncludePlugin","options","app","source","md","include","env","page","markdownEnv","frontmatter","filePathRelative","includedFiles","file","path"],"mappings":"qFAOa,MAAAA,EACVC,GACAC,GAAQ,CACP,MAAMC,EAASD,EAAI,IAAI,OAAO,EAE9B,MAAO,CACL,KAAM,oCAEN,gBAAkBE,GAAO,CACvBA,EAAG,IAAIC,EAAS,CACd,YAAcC,GAAqBA,EAAI,SACvC,GAAGL,CACL,CAAC,CACH,EACA,YAAcM,GAAe,CAC3B,KAAM,CAAE,YAAAC,EAAa,YAAAC,EAAa,iBAAAC,CAAiB,EAAIH,EACjD,CAAE,cAAAI,EAAgB,CAAG,CAAA,EAAIH,EAG/BD,EAAK,KAAK,KAAK,GAAGI,CAAa,GAG5BF,EAAY,aAAwC,CAAI,GAAA,KACzD,GAAGE,EAAc,IAAKC,GACpBC,EAAK,SACHA,EAAK,QAAQV,EAAQO,EAAkB,IAAI,EAC3CG,EAAK,QAAQV,EAAQO,EAAkBE,CAAI,CAC7C,CACF,CACF,CACF,CACF,CACF"}