#!/usr/bin/env node
import{removeEndingSlash as f,removeLeadingSlash as m}from"@vuepress/helper";import{cac as b}from"cac";import{resolveCliAppConfig as v,resolveUserConfigPath as y,resolveUserConfigConventionalPath as C,loadUserConfig as j,resolveAppConfig as w,transformUserConfigToPlugin as x}from"vuepress/cli";import{createBuildApp as $}from"vuepress/core";import{logger as n,fs as r,path as s}from"vuepress/utils";var P="@vuepress/plugin-redirect",k="2.0.0-rc.66",S="VuePress plugin - redirect",A=["vuepress-plugin","vuepress","plugin","redirect"],H="https://ecosystem.vuejs.press/plugins/tools/redirect.html",T={url:"https://github.com/vuepress/ecosystem/issues"},U={type:"git",url:"git+https://github.com/vuepress/ecosystem.git",directory:"plugins/tools/plugin-redirect"},D="MIT",E={name:"Mr.Hope",email:"mister-hope@outlook.com",url:"https://mister-hope.com"},V="module",M={".":"./lib/node/index.js","./client":"./lib/client/index.js","./package.json":"./package.json"},R="./lib/node/index.js",F="./lib/node/index.d.ts",G={"vp-redirect":"./lib/cli/index.js"},I=["lib"],L={build:"tsc -b tsconfig.build.json",bundle:"rollup -c rollup.config.ts --configPlugin esbuild",clean:"rimraf --glob ./lib ./*.tsbuildinfo",style:"sass src:lib --embed-sources --style=compressed"},N={"@vuepress/helper":"workspace:*","@vueuse/core":"^12.0.0",cac:"^6.7.14",vue:"^3.5.13"},q={vuepress:"2.0.0-rc.19"},z={access:"public"},B={name:P,version:k,description:S,keywords:A,homepage:H,bugs:T,repository:U,license:D,author:E,type:V,exports:M,main:R,types:F,bin:G,files:I,scripts:L,dependencies:N,peerDependencies:q,publishConfig:z};const O=i=>`<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="robots" content="noindex">
  <meta http-equiv="refresh" content="0; url=${i}">
  <link rel="canonical" href="${i}">
  <title>Redirecting...</title>
  <script>
    const anchor = window.location.hash.substring(1);
    location.href = \`${i}\${anchor? \`#\${anchor}\`: ""}\`;
  <\/script>
</head>
<body>
  <p>Redirecting...</p>
</body>
</html>
`,o=b("vp-redirect");o.command("generate [source-dir]","Generate redirect site using VuePress project under source folder").option("--hostname <hostname>","Hostname to redirect to (E.g.: https://new.example.com/)",{default:"/"}).option("-c, --config <config>","Set path to config file").option("-o, --output <output>","Set the output directory (default: .vuepress/redirect)").option("--cache <cache>","Set the directory of the cache files").option("-t, --temp <temp>","Set the directory of the temporary files").option("--clean-cache","Clean the cache files before generation").option("--clean-temp","Clean the temporary files before generation").action(async(i,e)=>{if(!i){o.outputHelp();return}process.env.NODE_ENV??="production";const c=v(i,{}),g=e.config?y(e.config):C(c.source),{userConfig:p}=await j(g),a=w({defaultAppConfig:{},cliAppConfig:c,userConfig:p});if(a===null)return;const t=$(a);t.use(x(p,c.source)),e.cleanTemp===!0&&(n.info("Cleaning temp..."),await r.remove(t.dir.temp())),e.cleanCache===!0&&(n.info("Cleaning cache..."),await r.remove(t.dir.cache()));const l=e.output?s.join(process.cwd(),e.output):s.join(t.dir.source(),".vuepress","redirect");await r.emptyDir(l),n.info("Initializing VuePress and preparing data..."),await t.init(),n.info("Generating redirect pages..."),await Promise.all(t.pages.map(u=>{const h=`${f(e.hostname)}${t.options.base}${m(u.path)}`,d=s.join(l,m(u.path.replace(/\/$/,"/index.html")));return r.ensureDir(s.dirname(d)).then(()=>r.writeFile(d,O(h)))}))}),o.command("").action(()=>{o.outputHelp()}),o.help(),o.version(B.version),o.parse();
//# sourceMappingURL=index.js.map
